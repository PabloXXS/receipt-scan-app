# AI-пайплайн

## Поток

1. Клиент загружает изображение чека в приватный бакет (Supabase Storage)
2. Создается запись `files`, черновик `receipts(status=processing)`
3. Edge Function инициирует анализ:
   - OCR (TBD)
   - LLM структурирует результат (TBD)
4. Результат маппится в `receipts` + `receipt_items`
5. Статус чека -> `ready` (или `failed` с `error_text`)
6. Клиент пуллит статус / получает push (позже) и показывает данные

## Контракт результата (пример)

```json
{
  "store": "Магазин ABC",
  "date": "2025-09-26",
  "time": "14:23:10",
  "currency": "RUB",
  "total": 1250.5,
  "items": [
    { "name": "Молоко 1л", "qty": 1, "price": 89.9 },
    { "name": "Хлеб", "qty": 1, "price": 45.0 }
  ]
}
```

## Порог уверенности

- TBD: правила авто-принятия vs просьба подтвердить в UI

## Квоты/очередь

- TBD: лимиты/дедупликация/ретраи
